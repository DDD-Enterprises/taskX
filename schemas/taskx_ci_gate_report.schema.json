{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TaskX CI Gate Report",
  "description": "CI gate report combining doctor checks and promotion validation",
  "type": "object",
  "required": [
    "schema_version",
    "generated_at",
    "timestamp_mode",
    "status",
    "doctor",
    "promotion",
    "checks"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version for this report format"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation"
    },
    "timestamp_mode": {
      "type": "string",
      "enum": ["deterministic", "wallclock"],
      "description": "Timestamp generation mode used"
    },
    "status": {
      "type": "string",
      "enum": ["passed", "failed"],
      "description": "Overall CI gate status"
    },
    "doctor": {
      "type": "object",
      "required": ["status", "report_path", "missing_schemas"],
      "additionalProperties": false,
      "properties": {
        "status": {
          "type": "string",
          "enum": ["passed", "failed"],
          "description": "Doctor check overall status"
        },
        "report_path": {
          "type": ["string", "null"],
          "description": "Path to underlying doctor report if written, null otherwise"
        },
        "missing_schemas": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of required schemas that are missing"
        }
      }
    },
    "promotion": {
      "type": "object",
      "required": [
        "required",
        "validated",
        "run_dir",
        "promotion_path",
        "promotion_status",
        "errors"
      ],
      "additionalProperties": false,
      "properties": {
        "required": {
          "type": "boolean",
          "description": "Whether promotion validation was required"
        },
        "validated": {
          "type": "boolean",
          "description": "Whether promotion was successfully validated"
        },
        "run_dir": {
          "type": ["string", "null"],
          "description": "Run directory path, null if not validated"
        },
        "promotion_path": {
          "type": ["string", "null"],
          "description": "Path to promotion file, null if not found"
        },
        "promotion_status": {
          "type": ["string", "null"],
          "enum": ["passed", "failed", null],
          "description": "Status from promotion token, null if not validated"
        },
        "errors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of promotion validation errors"
        }
      }
    },
    "checks": {
      "type": "object",
      "required": ["passed", "failed", "warnings", "items"],
      "additionalProperties": false,
      "properties": {
        "passed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of checks that passed"
        },
        "failed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of checks that failed"
        },
        "warnings": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of checks with warnings"
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "status", "message", "remediation"],
            "additionalProperties": false,
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique identifier for this check"
              },
              "status": {
                "type": "string",
                "enum": ["pass", "fail", "warn"],
                "description": "Status of this individual check"
              },
              "message": {
                "type": "string",
                "description": "Human-readable check result message"
              },
              "remediation": {
                "type": "array",
                "items": {"type": "string"},
                "description": "List of remediation steps if check failed"
              }
            }
          },
          "description": "Detailed results for each check performed"
        }
      }
    }
  }
}
